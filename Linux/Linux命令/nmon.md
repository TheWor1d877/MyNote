## 安装与两种核心模式
```bash
sudo apt update && sudo apt install nmon
```

nmon 有两种完全不同的使用模式:交互式模式,录制模式

| 模式       | 交互式模式         | 录制模式                   |
| -------- | ------------- | ---------------------- |
| **启动命令** | `nmon`        | `nmon -f -s 10 -c 60`  |
| **用途**   | **实时巡检、快速诊断** | **基准测试、故障留存、报告生成**     |
| **输出**   | 屏幕交互界面        | 生成 `.nmon` 或 `.csv` 文件 |

## 交互式模式
```
3 帮助：按 h 关闭本提示，按 q 退出
─────────────────────────

以下字母键可开关对应统计项：

h = 显示/关闭本帮助
c = CPU 利用率（再按一次 C 可展开更宽视图）
m = 内存 & 交换区（再按 L 显示大页内存）
n = 网络
d = 磁盘 I/O 图表（再按 D 切到纯数字统计）
k = 内核统计 & 平均负载
M = 各线程/CPU 实际运行频率（MHz）

l = 长期 CPU 平均
L = 大页内存
V = 虚拟内存
N = NFS
o = 磁盘繁忙度热力图
j = 文件系统使用率（再按 J 简化视图）
g = 自定义磁盘组（需启动时加 -g 文件）
G = 仅显示磁盘组图表
b = 黑白模式（去色）

t = Top 进程（再按 1 可切排序列：优先级/Nice/状态）
  排序快捷键：3=CPU 4=内存 5=I/O
u = Top 进程带完整命令行（连按两次 u 立即刷新）

r = 系统资源 & 进程概览

其它控制：
+ = 刷新间隔翻倍（变慢）
- = 刷新间隔减半（变快）
. = 仅显示“忙”的磁盘和 CPU（过滤空闲）
0 = 把峰值标记“>”清零
空格 = 立即刷新一次
q = 退出

颜色示例：#0# #1# … #12# （只是告诉你有哪些配色，不用记）

(C) Nigel Griffiths 2009  
官网：http://nmon.sourceforge.net
```

1. **`c`： CPU视图**
- **看什么**：`User%`、`Sys%`、`Wait%`（即IO等待，**磁盘瓶颈关键指标**）。
- **关联思考**：如果 `Wait%` 高，下一步马上按 `d` 看磁盘。
1. **`m`： 内存视图**
- **看什么**：`RAM` 的 `free`、`cached`；`Swap` 是否被使用。
- **关键点**：Linux会利用空闲内存做**缓存 (`cached`)**，所以 `free` 少不一定有问题。但如果 `Swap` 持续有读数，说明物理内存不足。
1. **`d`： 磁盘视图（对你最重要）**
- **看什么**：`Disk-Read`、`Disk-Write`（KB/s）、`IO/sec`。  
- **关键指标**：**`Xfers` (IOPS)** 和 **`AvgWait` (平均等待毫秒)**。对于SSD，`AvgWait` > 1ms 就可能有问题；对于HDD，> 20ms 需要注意。
- **动手实验**：另开终端运行 `dd if=/dev/zero of=/tmp/test.img bs=1M count=1024`，观察 `nmon` 中磁盘的 `Write` 和 `Xfers` 如何变化。  
1. **`n`： 网络视图*
- **看什么**：每个网卡（如 `eth0`、`ens33`）的 `Recv`、`Send`（KB/s）。
- **关联思考**：网络流量激增时，按 `c` 看CPU的 `Sys%` 是否也升高（网络包处理需要CPU）。
1. **`j`： 文件系统视图**
- **看什么**：每个挂载点的使用百分比（`Use%`）。
- **关键点**：磁盘空间满会导致服务完全不可用，这是最直接的故障点。
1. **`r`： 资源视图（汇总）**
- **这是 `nmon` 的精华**：**一屏同时看CPU、内存、磁盘和网络的总览**。
- **动手实验**：保持 `r` 视图，在另一个终端执行：

## 录制模式
基础录制 `nmon -f -s 10 -c 60`

基准测试录制:
 ```bash
 nmon -f -F baseline.nmon -s 5 -c 12
 # 等待录制完成，然后开始你的压测...
 # 压测结束后，再录制1分钟后期数据
 nmon -f -F post_test.nmon -s 5 -c 12
 ```

高级录制：包含进程数据
```bash
nmon -f -s 5 -c 120 -t
```

