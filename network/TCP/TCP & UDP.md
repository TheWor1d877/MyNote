## TCP与UDP的区别
TCP有连接，可靠，具有重发机制，流量控制，拥塞控制,通过三次握手与四次挥手来保障自己的数据稳定可靠的传输
UDP无连接，不可靠，不能保证数据一定送达。但是高速实时，允许少量丢包。

## TCP百万并发
TCP的连接依靠一对四元组，端口号只有65535不影响百万并发


## TCP深入
### TCP字段
- seq
**seq作用**：  
在TCP连接中，seq（序列号）用于标识发送数据的字节流顺序，确保数据可靠传输、按序重组，并解决重复包问题。  

**为什么双方随机初始化**：  
1. **安全**：避免序列号预测攻击（如TCP伪造）。  
2. **避免历史连接干扰**：随机化可降低新旧连接数据混淆的风险。  
3. **协议规范**：RFC要求初始序列号尽量不可预测，增强可靠性。

- Ack
ACK报文是确认报文，仅携带确认号（Acknowledgment Number），用于告知对方下一次期望接收的序列号。ACK本身不消耗序列号，序列号仅用于携带数据的报文段（包括SYN/FIN标志）

- Win与Ws
**窗口机制**：
- **win（窗口大小）**：接收方通过 `win` 字段通告其**剩余接收缓冲区大小**，单位字节。作用：**流量控制**，防止发送方压满接收方缓冲区。
- **WS（窗口缩放因子）**：在TCP三次握手时协商的一个**缩放系数**（2^WS倍），用于将 `win` 字段的16位值**实际放大**，以支持**高速网络**下的更大窗口（如千兆/万兆网络）。

- MSS
指TCP层可接收的数据最大长度，仅含应用数据，不包括TCP/IP头部。在三次握手时由双方通告，用于优化分段，避免IP分片。典型值如以太网中为 1460 字节（MTU 1500 减40字节头）。

- len
Len（数据长度）：
指TCP报文段中实际携带的应用层数据长度（单位：字节）。在抓包中常计算为：Total Length - IP头 - TCP头。仅当传输数据时 Len > 0。

### TCP机制
#### 重传机制
TCP重传机制：
核心是确保数据可靠送达。主要分为两类：
1. 超时重传（RTO）
发送数据后启动重传定时器，若在RTO内未收到ACK，则重发该数据。
RTO值动态计算（基于RTT），超时后RTO会指数退避。
2. 快速重传
接收方收到乱序数据时，立即重复ACK确认最后一个按序字节。
发送方收到3个重复ACK，判定该数据丢失，立即重传（无需等待超时），并进入快速恢复阶段。

SACK（选择性确认）：允许接收方告知发送方已收到的不连续数据块，发送方仅重传真正丢失的部分。
超时重传会大幅降低发送速率（拥塞窗口置为1），而快速重传影响较小（拥塞窗口减半）。

#### 流量控制
目的是防止发送方发送数据过快，导致接收方缓冲区溢出。

1. 接收方通过TCP头中的 win（窗口大小）字段，实时通告自己剩余接收缓冲区大小。
2. 发送方必须保证：已发送但未确认的数据量 ≤ 接收方通告的窗口大小。
3. 当接收方缓冲区满时，可通告 win=0，此时发送方暂停发送，并启动持久计时器定期探测窗口是否恢复。

#### 拥塞控制
目的是**防止发送方数据注入过快导致网络拥塞**，核心是动态调整**拥塞窗口（cwnd）**。
1. 慢启动：连接开始时，cwnd指数增长（每RTT翻倍），快速探测可用带宽。
2. 拥塞避免：到达慢启动阈值（ssthresh）后，cwnd转为线性增长（每RTT +1 MSS），谨慎试探上限。
拥塞发生时的应对：
- 超时重传：判定为严重拥塞，将 ssthresh = cwnd/2，cwnd = 1，重启慢启动。
- 快速重传/快速恢复（收到3个重复ACK）：判定为轻度丢包，ssthresh = cwnd/2，cwnd = ssthresh + 3 MSS，之后每收到一个重复ACK则cwnd +1 MSS，收到新数据ACK后降至ssthresh。

#### 滑动窗口
是实现可靠传输、流量控制与拥塞控制的核心机制，在发送方维护一个动态窗口，表示允许连续发送的数据范围。
- 四部分
发送且已确认（窗口左侧，已交付）
已发送未确认（在途数据）
待发送（可发送）（窗口内，允许立即发送）
不可发送（窗口右侧，需等待窗口滑动）

- 作用
**允许连续发送**：不必每发一个包等一个ACK，提升吞吐。
**实现流量/拥塞控制**：通过调整窗口大小限速。
**保证顺序**：接收方按序列号重组数据。